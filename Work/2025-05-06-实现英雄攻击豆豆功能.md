# 实现英雄攻击豆豆功能

## 需求描述
实现英雄对豆豆进行攻击的功能，使英雄能够主动攻击豆豆敌人。

## 实现方案
1. 在Hero类中添加攻击相关的属性和方法
2. 在BattleCommand中添加攻击命令的定义
3. 在BattleManager中添加处理攻击命令的逻辑
4. 在EntityRenderer中为豆豆添加点击交互
5. 在TouchController中添加处理豆豆点击事件的逻辑

## 具体修改

### 1. 修改Hero类
- 添加攻击相关的属性：攻击范围、攻击间隔、上次攻击时间、目标ID等
- 添加伤害管理器和实体管理器的引用
- 添加攻击目标的方法`attackTarget`
- 添加设置和获取攻击相关属性的方法
- 在update方法中添加自动攻击目标的逻辑

### 2. 修改BattleCommand
- 添加攻击命令类型`attack`
- 添加攻击命令接口`AttackCommand`
- 更新战斗指令联合类型

### 3. 修改BattleManager
- 添加处理攻击命令的方法`processAttackCommand`
- 在processCommands方法中添加对攻击命令的处理
- 在创建英雄时设置伤害管理器和实体管理器

### 4. 修改EntityRenderer
- 为豆豆实体添加点击交互功能
- 添加点击事件，触发`beanClicked`事件
- 传递豆豆ID和位置信息

### 5. 修改TouchController
- 添加监听`beanClicked`事件
- 添加`onBeanClicked`方法处理豆豆点击事件
- 添加`attackBean`方法发送攻击命令
- 添加`castSkillAtBean`方法使用技能攻击豆豆
- 添加`playAttackVisualEffect`方法显示攻击视觉效果

## 玩家操作方式
玩家可以通过以下方式操作英雄攻击豆豆：

1. **直接点击豆豆进行普通攻击**：
   - 在战斗场景中直接点击豆豆
   - 英雄会自动发起普通攻击
   - 会显示攻击线作为视觉反馈

2. **选择技能后点击豆豆**：
   - 先点击技能按钮选择技能
   - 然后点击豆豆作为技能目标
   - 英雄会使用选中的技能攻击豆豆

## 测试方法
可以通过以下方式测试英雄攻击豆豆功能：
1. 发送攻击命令：`battleManager.sendCommand({type: 'attack', frame: currentFrame, playerId: 'player1', data: {heroId: 1, targetId: 2}})`
2. 设置英雄的目标ID：`hero.setTargetId('bean_1')`，英雄会在update方法中自动攻击目标
3. 在游戏中直接点击豆豆测试交互功能

## 注意事项
- 英雄攻击豆豆需要在攻击范围内
- 攻击有冷却时间，不能连续攻击
- 需要正确设置伤害管理器和实体管理器才能正常工作
- 豆豆需要在屏幕内才能被点击，屏幕外的豆豆需要通过指示器找到

## 更新记录

### 2025-05-06 更新：增强攻击效果和持续攻击功能

1. **增强豆豆被攻击的视觉效果**
   - 添加红色闪烁效果
   - 添加震动效果
   - 添加缩放效果
   - 添加闪光效果

2. **实现持续攻击功能**
   - 点击豆豆后，英雄会设置该豆豆为持续攻击目标
   - 英雄会在update方法中自动攻击目标
   - 当目标死亡或超出攻击范围时，会自动清除目标

3. **修复伤害事件触发**
   - 确保攻击成功后触发damageDealt事件
   - 确保豆豆死亡后触发entityDeath事件
   - 这些事件确保UI能够正确显示伤害效果和死亡动画
