# 2025-05-06 战斗场UI改进

## 状态栏同时显示水晶HP和英雄HP/MP

### 需求描述
用户希望在战斗场景中的状态栏同时显示水晶HP和英雄HP/MP，而不是只显示其中一种。这样玩家可以同时关注水晶和英雄的状态，提高游戏体验。

### 实现方案
1. 修改`UIManager.ts`文件中的`createStatusBar`方法，添加水晶HP显示
2. 修改`UIManager.ts`文件中的`updateStatusBar`方法，支持同时更新水晶HP和英雄HP/MP
3. 修改`BattleSceneView.ts`文件中的`updateUI`方法，同时获取和显示水晶和英雄的状态
4. 修改`EventHandlers.ts`文件中的`onEntityStatsChanged`方法，确保正确调用新的`updateStatusBar`方法

### 修改的文件
1. `src/Battle/View/UIManager.ts`
   - 修改`createStatusBar`方法，添加水晶HP显示
   - 修改`updateStatusBar`方法，支持同时更新水晶HP和英雄HP/MP
   - 添加`updateStatusBarLegacy`方法，兼容旧版API

2. `src/Battle/View/BattleSceneView.ts`
   - 修改`updateUI`方法，同时获取和显示水晶和英雄的状态

3. `src/Battle/View/EventHandlers.ts`
   - 修改`onEntityStatsChanged`方法，确保正确调用新的`updateStatusBar`方法

### 实现细节

#### 状态栏布局
- 水晶HP显示在状态栏顶部，使用💎图标和浅红色条形图
- 英雄HP显示在中间，使用🧙图标和红色条形图
- 英雄MP显示在底部，使用蓝色条形图
- 状态栏高度从60px增加到90px，以容纳三个条形图
- 状态栏宽度从180px增加到220px，以容纳更多信息

#### 水晶HP颜色变化
- 生命值正常（>70%）：浅红色 (0xff5555)
- 生命值警告（30%-70%）：黄色 (0xffff00)
- 生命值危险（<30%）：红色 (0xff0000)

#### 兼容性处理
- 添加`updateStatusBarLegacy`方法，兼容旧版API
- 在新的`updateStatusBar`方法中添加错误处理，确保即使出错也不会影响游戏运行

### 效果
修改后，战斗场景的状态栏同时显示水晶HP和英雄HP/MP，玩家可以同时关注水晶和英雄的状态。当水晶受到伤害时，水晶HP条会减少，并根据生命值百分比改变颜色，提供直观的视觉反馈。

### 后续工作
1. 考虑添加水晶生命值百分比显示，使玩家能够更直观地了解水晶的生命状态
2. 考虑添加水晶受伤的视觉效果，使玩家更容易看到水晶受到伤害
3. 考虑添加水晶生命值低于一定百分比时的警告效果，提醒玩家注意保护水晶
