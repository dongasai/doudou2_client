# 2025-05-06 修复战斗场景UI

## 修复战斗界面状态栏问题

### 问题描述
战斗界面中的状态栏显示不清晰，UI元素之间存在重叠问题。从截图中可以看到，状态栏的文本显示不清晰，背景透明度不够，波次指示器位置不合理。

### 问题分析
1. **状态栏问题**：
   - 状态栏中的水晶图标和英雄头像占用了宝贵的空间
   - 文本显示不够清晰，缺少描边
   - 背景透明度不够，导致文本在某些背景下难以辨认

2. **波次指示器问题**：
   - 波次指示器位置不合理，与暂停按钮重叠
   - 缺少背景，导致在某些场景下难以辨认
   - 字体大小不够明显

### 修复方案
1. **状态栏改进**：
   - 移除水晶图标和英雄头像，节省空间
   - 增加状态栏背景的不透明度，从0.7提高到0.8
   - 增加生命值条和魔法值条的高度，从12px增加到15px
   - 增加文本大小，并添加描边，提高可读性

2. **波次指示器改进**：
   - 添加黑色半透明背景，提高可读性
   - 增加字体大小和描边粗细
   - 调整位置，使其更加明显
   - 设置文本居中对齐

3. **暂停按钮调整**：
   - 将暂停按钮下移，避免与波次指示器重叠
   - 保持原有样式和功能

### 修改的文件
1. `src/Battle/View/UIManager.ts`
   - 修改 `createStatusBar` 方法，移除水晶图标和英雄头像
   - 修改 `updateStatusBar` 方法，更新元素索引
   - 修改 `createWaveIndicator` 方法，添加背景并调整样式
   - 修改 `createPauseButton` 方法，调整位置
   - 修改 `destroy` 方法，添加错误处理
   - 移除未使用的 `uiContainer` 变量

### 具体修改
1. **状态栏修改**：
   ```typescript
   // 创建背景 (黑色半透明矩形)
   const bg = this.scene.add.rectangle(0, 0, barWidth, barHeight, 0x000000, 0.8); // 增加不透明度
   
   // 计算生命值条和魔法值条的尺寸和位置
   const barX = 10; // 条形图X坐标
   const barLength = barWidth - barX - 10; // 条形图长度
   const barHeight1 = 15; // 条形图高度
   
   // 创建水晶生命值文本
   const crystalHpText = this.scene.add.text(textX, crystalY, '水晶: 1000/1000', {
     fontSize: `${textSize}px`,
     color: '#ffffff',
     stroke: '#000000',
     strokeThickness: 2
   });
   ```

2. **波次指示器修改**：
   ```typescript
   // 创建波次指示器背景
   const bgWidth = 120;
   const bgHeight = 40;
   const bgX = screenWidth - 20;
   const bgY = 10;
   
   const bg = this.scene.add.rectangle(
     bgX,
     bgY + bgHeight / 2,
     bgWidth,
     bgHeight,
     0x000000,
     0.8
   );
   bg.setOrigin(1, 0.5);
   bg.setDepth(DepthLayers.UI_BACKGROUND);
   bg.setScrollFactor(0);
   
   // 创建波次指示器 (位于屏幕右上角)
   this.waveIndicator = this.scene.add.text(
     bgX - bgWidth / 2,         // X坐标：居中显示在背景上
     bgY + bgHeight / 2,        // Y坐标：居中显示在背景上
     'Wave:1',
     {
       fontSize: `${fontSize}px`,
       color: '#ffffff',        // 白色文本
       stroke: '#000000',       // 黑色描边
       strokeThickness: Math.max(3, fontSize / 6),  // 增加描边粗细
       align: 'center'          // 文本居中对齐
     }
   );
   ```

3. **暂停按钮修改**：
   ```typescript
   // 计算按钮位置 (右上角，在波次指示器下方)
   const x = screenWidth - 20; // 距离右边缘20像素
   const y = 60; // 在波次指示器下方
   ```

### 效果
修复后，战斗界面的状态栏更加清晰可见，波次指示器和暂停按钮不再重叠，整体UI更加美观和易用。

1. **状态栏**：
   - 更加简洁，只显示必要的信息
   - 文本更加清晰，添加了描边
   - 背景更加不透明，提高了可读性

2. **波次指示器**：
   - 添加了背景，更加醒目
   - 字体更大，更容易看清
   - 位置更合理，不再与其他UI元素重叠

3. **暂停按钮**：
   - 位置调整，避免与波次指示器重叠
   - 保持原有功能和样式

### 后续优化建议
1. 考虑添加水晶生命值百分比显示，使玩家能够更直观地了解水晶的生命状态
2. 优化UI更新逻辑，减少不必要的更新，提高性能
3. 添加水晶受伤的视觉效果，使玩家更容易看到水晶受到伤害
