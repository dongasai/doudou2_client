# 战斗UI改进：分离战斗视图和UI视图

## 问题描述

在战斗场景中，当摄像机跟随英雄移动时，UI元素（如暂停按钮、波次指示器等）也会跟着移动，导致它们可能移出屏幕，用户无法点击。这是因为UI元素和战斗场景元素都受到同一个摄像机的控制。

## 解决方案

将战斗视图和UI视图分离，使UI元素固定在屏幕上，不受摄像机移动的影响。

### 实现方式

1. 创建一个UI容器，用于存放所有UI元素
2. 设置UI元素的`scrollFactor`为0，使其不随摄像机移动
3. 在摄像机移动时，确保UI元素保持固定

### 修改的文件

- `src/Battle/View/BattleSceneView.ts`

### 具体修改

1. 添加UI容器属性
```typescript
// UI容器，用于存放所有UI元素
private uiContainer: Phaser.GameObjects.Container;
```

2. 修改`fixUIElements`方法，创建UI容器并设置scrollFactor
```typescript
private fixUIElements(): void {
  try {
    // 创建UI容器
    this.uiContainer = this.scene.add.container(0, 0);
    this.uiContainer.setName('uiContainer');
    
    // 设置UI容器的scrollFactor为0，使其不随摄像机移动
    this.uiContainer.setScrollFactor(0);
    
    // 设置各个UI元素的scrollFactor为0
    this.statusBar.setScrollFactor(0);
    this.waveIndicator.setScrollFactor(0);
    this.pauseButton.setScrollFactor(0);
    this.skillButtonsContainer.setScrollFactor(0);

    // 确保所有子元素也不随摄像机移动
    for (const skillUI of this.skillUIComponents.values()) {
      skillUI.getContainer().setScrollFactor(0);
    }
    
    console.log('[DEBUG] UI元素已固定，不会随摄像机移动');
  } catch (error) {
    console.error('[ERROR] 固定UI元素失败:', error);
  }
}
```

3. 修改`focusCameraOnHero`方法，确保摄像机移动时UI元素保持固定
```typescript
private focusCameraOnHero(heroPosition: Vector2D): void {
  // 将世界坐标转换为屏幕坐标
  const screenPos = this.worldToScreenPosition(heroPosition);

  // 设置摄像机跟随目标
  this.scene.cameras.main.pan(
    screenPos.x,
    screenPos.y,
    300, // 移动持续时间（毫秒）
    'Sine.easeOut' // 缓动函数
  );
  
  // 确保UI元素不受摄像机移动影响
  if (this.uiContainer) {
    this.uiContainer.setScrollFactor(0);
  }
  
  // 单独确保每个UI元素不受影响
  this.statusBar.setScrollFactor(0);
  this.waveIndicator.setScrollFactor(0);
  this.pauseButton.setScrollFactor(0);
  this.skillButtonsContainer.setScrollFactor(0);
}
```

## 效果

1. 战斗场景可以正常滚动，跟随英雄移动
2. UI元素（暂停按钮、波次指示器、状态栏、技能按钮）固定在屏幕上，不会移出视野
3. 用户可以随时点击UI元素，不受战斗场景滚动的影响

## 后续改进建议

1. 考虑使用Phaser的多摄像机功能，创建专门的UI摄像机
2. 优化UI元素的层级管理，确保它们始终显示在战斗场景之上
3. 添加UI元素的自适应布局，适应不同屏幕尺寸
